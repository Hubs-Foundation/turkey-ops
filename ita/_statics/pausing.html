
<!DOCTYPE html>
<html>
<head>
	<style>
		body {
			background-color: black;
			color: white;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100vh;
			flex-direction: column;
		}
		#pic {
			width: 200px;
			height: 200px;
		}
	</style>
</head>
<body>
    <img id="duckPic" src="https://storage.googleapis.com/turkey-assets/logos/hubsduck.png"/>
	<div id="msg_line0">this hubs' paused due to inactivity</div>
	<div id="msg_line1"></div>
    <div id="msg_line2">[ . ]</div>

	<script>
        var socket = new WebSocket("wss://" + window.location.host+"/websocket")
        var countdown=10;
        var go=false
        var started=false
        var done=false

        updateDuckRotation(countdown)

        socket.onmessage = function (event) {
            if (event.data=="hi"){
                go=true
            }
            if (event.data=="_refresh_"){
                done=true
                document.getElementById('msg_line1').innerText = "done (this page should refresh automatically)"
                document.getElementById('msg_line2').innerText = "[ infra components may take a few more minutes to fully sync ]"
                setInterval(function() {                
                    location.reload();
                }, 3000);
            }
            document.getElementById('msg_line2').innerText = "[ "+event.data+" ]"
        };
        socket.onopen = function (event) {
            socket.send("hi")
        };
        window.addEventListener('keypress', function (event) {
                socket.send("keyCode:"+event.keyCode)
        });

        countdownInterval = setInterval(function() {
            if (go && !document.hidden){
                countdown--;
                updateDuckRotation(countdown)
                document.getElementById('msg_line2').innerText = "[ unpausing start in: " + countdown + " sec ]";
            }
            if (countdown <= 0 || countdown > 20) {
                socket.send("_r_: 1")
                document.getElementById('msg_line1').innerText = "unpausing"
                started=true
                clearInterval(countdownInterval);
            }
        }, 1000);
        
		document.getElementById('duckPic').addEventListener('click', function() {
			countdown++;
            updateDuckRotation(countdown)
            if (started){                
                return
            }
            document.getElementById('msg_line2').innerText = "[ unpausing start in: " + countdown + "/20 clicks ]";
		});


        function updateDuckRotation(countdown){
            document.getElementById('duckPic').style.transform='rotate(' + (countdown * 18).toString() + 'deg)';
        }

        // // inits
		// var clickCount = 0;
		// var resuming = false;
        
        // var pDiv = document.getElementById('pausingDiv')
        // var playBtn = document.getElementById("playBtn");

        // var duckChk= document.getElementById("duckChk")
        // var duckPic = document.getElementById("duckPic")
        // var slider = document.getElementById("slider");
        
        // //playBtn
        // playBtn.addEventListener('click', function() {
        //     pDiv.style.display = 'none'
        //     duckChk.style.display = ''
		// });



        // fetch('/', {method: 'UPDATE'}).then(response => response.text()).then(data => {
        //     pText.innerText = data;})
        
        // //text
        // setInterval(function() {
        //     if (!resuming) {return}
        //     fetch('/', {method: 'UPDATE'})
        //     .then(response => response.text())
        //     .then(data => {pText.innerText = data;})
        //     .catch(error => console.error('Error:', error));
        // }, 11000); // milliseconds        

        // //image
		// image.addEventListener('click', function() {
		// 	clickCount++;
		// 	if (clickCount >= 6 && !resuming) {
		// 		resuming = true
		// 		fetch('/', {method: 'PUT'}).then(response => response.json())
        //         .then(data => {document.getElementById('pausingText').innerText = data;})
		// 		.catch(error => console.error('Error:', error));
		// 	}
		// });

        // //slider
        // var slider = document.getElementById("slider");
        // // var mouseDownValue = 0;
        // // var mouseUpValue = 0;
        // // slider.onmousedown = function() {
        // //     mouseDownValue = this.value;
        // // };
        // slider.onmouseup = function() {
        //     // mouseUpValue = this.value;
        //     // var rotation = mouseUpValue - mouseDownValue;
        //     // console.log('Rotated: ' + rotation + ', current: ' + this.value );
        //     console.log('angle:', this.value)
        // };
        // slider.oninput = function() {
        //     image.style.transform = 'rotate(' + this.value + 'deg)';
        // };

	</script>
</body>
</html>	